<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>解读好用的 RecyclerView 第三方库 Groupie | Iamasoldier6&#39;s Column</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="剑如初，心如故，三千弱水繁华路。

Groupie 用来展示和管理复杂的 RecyclerView 布局，此第三方库在我厂的几款 App 中多个模块里都有所应用。个人也是从一开始的一无所知，到现在的大体了解，感觉还是蛮好用的。这期就来解读一番这个灵活的 RecyclerView 第三方库。">
<meta property="og:type" content="article">
<meta property="og:title" content="解读好用的 RecyclerView 第三方库 Groupie">
<meta property="og:url" content="http://iamasoldier6.com/2017/11/18/解读好用的-RecyclerView-第三方库-Groupie/index.html">
<meta property="og:site_name" content="Iamasoldier6's Column">
<meta property="og:description" content="剑如初，心如故，三千弱水繁华路。

Groupie 用来展示和管理复杂的 RecyclerView 布局，此第三方库在我厂的几款 App 中多个模块里都有所应用。个人也是从一开始的一无所知，到现在的大体了解，感觉还是蛮好用的。这期就来解读一番这个灵活的 RecyclerView 第三方库。">
<meta property="og:image" content="https://pic.superbed.cn/item/5c7bae6a3a213b041713d11c">
<meta property="og:image" content="https://pic.superbed.cn/item/5c7bae823a213b041713d2e0">
<meta property="og:image" content="https://i.loli.net/2019/03/03/5c7b80d4d728b.jpg">
<meta property="og:updated_time" content="2019-03-03T10:38:59.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="解读好用的 RecyclerView 第三方库 Groupie">
<meta name="twitter:description" content="剑如初，心如故，三千弱水繁华路。

Groupie 用来展示和管理复杂的 RecyclerView 布局，此第三方库在我厂的几款 App 中多个模块里都有所应用。个人也是从一开始的一无所知，到现在的大体了解，感觉还是蛮好用的。这期就来解读一番这个灵活的 RecyclerView 第三方库。">
<meta name="twitter:image" content="https://pic.superbed.cn/item/5c7bae6a3a213b041713d11c">
  
    <link rel="alternative" href="/atom.xml" title="Iamasoldier6&#39;s Column" type="application/atom+xml">
  
  
    <link rel="icon" href="http://7xt0ac.com1.z0.glb.clouddn.com/shiba.jpeg">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="https://i.loli.net/2019/03/03/5c7b849a196a0.jpeg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Iamasoldier6</a></h1>
		</hgroup>

		
		<p class="header-subtitle">Forged from suffering, hardened by pain.</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">归档</a></li>
				        
							<li><a href="/about">关于我</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/Iamasoldier6" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="https://www.weibo.com/2253797763/profile?rightmod=1&wvr=6&mod=personinfo" title="weibo">weibo</a>
					        
								<a class="zhihu" target="_blank" href="https://www.zhihu.com/people/Iamasoldier6" title="zhihu">zhihu</a>
					        
								<a class="twitter" target="_blank" href="https://twitter.com/Iamasoldier6" title="twitter">twitter</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/AOSP/" style="font-size: 10px;">AOSP</a> <a href="/tags/Activity/" style="font-size: 11.43px;">Activity</a> <a href="/tags/Android/" style="font-size: 20px;">Android</a> <a href="/tags/Annotation/" style="font-size: 10px;">Annotation</a> <a href="/tags/Annual/" style="font-size: 11.43px;">Annual</a> <a href="/tags/Application/" style="font-size: 10px;">Application</a> <a href="/tags/Bundle/" style="font-size: 10px;">Bundle</a> <a href="/tags/Callback/" style="font-size: 10px;">Callback</a> <a href="/tags/Concurrency/" style="font-size: 12.86px;">Concurrency</a> <a href="/tags/Context/" style="font-size: 10px;">Context</a> <a href="/tags/Debug/" style="font-size: 10px;">Debug</a> <a href="/tags/DialogFragment/" style="font-size: 10px;">DialogFragment</a> <a href="/tags/Event/" style="font-size: 11.43px;">Event</a> <a href="/tags/EventBus/" style="font-size: 11.43px;">EventBus</a> <a href="/tags/Flutter/" style="font-size: 10px;">Flutter</a> <a href="/tags/Fragment/" style="font-size: 11.43px;">Fragment</a> <a href="/tags/Framework/" style="font-size: 10px;">Framework</a> <a href="/tags/Generics/" style="font-size: 10px;">Generics</a> <a href="/tags/Google/" style="font-size: 10px;">Google</a> <a href="/tags/HTML/" style="font-size: 10px;">HTML</a> <a href="/tags/Handler/" style="font-size: 10px;">Handler</a> <a href="/tags/HashMap/" style="font-size: 11.43px;">HashMap</a> <a href="/tags/I-O/" style="font-size: 10px;">I/O</a> <a href="/tags/Image/" style="font-size: 12.86px;">Image</a> <a href="/tags/Java/" style="font-size: 17.14px;">Java</a> <a href="/tags/JavaScript/" style="font-size: 10px;">JavaScript</a> <a href="/tags/Launch/" style="font-size: 10px;">Launch</a> <a href="/tags/ListView/" style="font-size: 10px;">ListView</a> <a href="/tags/Mac/" style="font-size: 12.86px;">Mac</a> <a href="/tags/Message/" style="font-size: 10px;">Message</a> <a href="/tags/Parameter/" style="font-size: 10px;">Parameter</a> <a href="/tags/Pattern/" style="font-size: 11.43px;">Pattern</a> <a href="/tags/Performance/" style="font-size: 11.43px;">Performance</a> <a href="/tags/React-Native/" style="font-size: 10px;">React Native</a> <a href="/tags/RecyclerView/" style="font-size: 15.71px;">RecyclerView</a> <a href="/tags/Reflection/" style="font-size: 10px;">Reflection</a> <a href="/tags/Source-Code/" style="font-size: 18.57px;">Source Code</a> <a href="/tags/Summary/" style="font-size: 11.43px;">Summary</a> <a href="/tags/Text/" style="font-size: 10px;">Text</a> <a href="/tags/TypeScript/" style="font-size: 10px;">TypeScript</a> <a href="/tags/Unit-Test/" style="font-size: 10px;">Unit Test</a> <a href="/tags/View/" style="font-size: 11.43px;">View</a> <a href="/tags/Volley/" style="font-size: 14.29px;">Volley</a>
					</div>
				</section>
				
				
				

				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">Iamasoldier6</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="https://i.loli.net/2019/03/03/5c7b849a196a0.jpeg" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">Iamasoldier6</h1>
			</hgroup>
			
			<p class="header-subtitle">Forged from suffering, hardened by pain.</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">归档</a></li>
		        
					<li><a href="/about">关于我</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/Iamasoldier6" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="https://www.weibo.com/2253797763/profile?rightmod=1&wvr=6&mod=personinfo" title="weibo">weibo</a>
			        
						<a class="zhihu" target="_blank" href="https://www.zhihu.com/people/Iamasoldier6" title="zhihu">zhihu</a>
			        
						<a class="twitter" target="_blank" href="https://twitter.com/Iamasoldier6" title="twitter">twitter</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap"><article id="post-解读好用的-RecyclerView-第三方库-Groupie" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/11/18/解读好用的-RecyclerView-第三方库-Groupie/" class="article-date">
  	<time datetime="2017-11-18T02:21:15.000Z" itemprop="datePublished">2017-11-18</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      解读好用的 RecyclerView 第三方库 Groupie
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/RecyclerView/">RecyclerView</a></li></ul>
	</div>

        

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        
  <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
  <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#简介-Groupie"><span class="toc-number">1.</span> <span class="toc-text">简介 Groupie</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Demo-用法"><span class="toc-number">2.</span> <span class="toc-text">Demo 用法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#源码解读"><span class="toc-number">3.</span> <span class="toc-text">源码解读</span></a></li></ol>
  </div>

        <blockquote>
<p>剑如初，心如故，三千弱水繁华路。</p>
</blockquote>
<p>Groupie 用来展示和管理复杂的 RecyclerView 布局，此第三方库在我厂的几款 App 中多个模块里都有所应用。个人也是从一开始的一无所知，到现在的大体了解，感觉还是蛮好用的。这期就来解读一番这个灵活的 RecyclerView 第三方库。<a id="more"></a></p>
<h2 id="简介-Groupie"><a href="#简介-Groupie" class="headerlink" title="简介 Groupie"></a><strong>简介 Groupie</strong></h2><p>Groupie 帮助我们可以将展示的内容看作逻辑组，再处理变动的通知，认为该片段是有着头部、尾部、可展开的组和垂直列的块，甚至更多。其使得处理异步的内容更新和插入，及用户驱动的内容变化变得很容易。在 item 层，其抽象出 item 视图类型、item 布局、viewholders 和跨度大小。这个库目前支持 databinding 和 Kotlin 相关的，暂且先不管，我们目前先只看 Java 层的通常用法及 library 的源码。</p>
<p>以上来自 <a href="https://github.com/lisawray/groupie" target="_blank" rel="external">GitHub</a>，此库由 MIT 高材生、原 Google 程序媛 <a href="http://www.xwray.com/" target="_blank" rel="external">Lisa Wray</a> 所写。</p>
<h2 id="Demo-用法"><a href="#Demo-用法" class="headerlink" title="Demo 用法"></a><strong>Demo 用法</strong></h2><p>Demo 地址：<a href="https://github.com/Iamasoldier6/AndroidExerciseDemos" target="_blank" rel="external">GroupieDemo</a>。</p>
<p><strong>引入 Gradle 依赖</strong>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile 'com.xwray:groupie:2.0.0-alpha2'</span><br></pre></td></tr></table></figure>
<p>MainActivity 类如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> GroupAdapter mAdapter;</span><br><span class="line">    <span class="keyword">private</span> RecyclerView mRvContent;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        mRvContent = findViewById(R.id.rv_content);</span><br><span class="line">        mRvContent.setLayoutManager(<span class="keyword">new</span> LinearLayoutManager(<span class="keyword">this</span>));</span><br><span class="line">        mAdapter = <span class="keyword">new</span> GroupAdapter();</span><br><span class="line">        <span class="comment">// 添加非空的组内容</span></span><br><span class="line">        mAdapter.addAll(getGroupList());</span><br><span class="line">        mRvContent.setAdapter(mAdapter);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> List&lt;Item&gt; <span class="title">getGroupList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;Item&gt; groupList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="comment">// 遍历添加 ContentItem</span></span><br><span class="line">            groupList.add(<span class="keyword">new</span> ContentItem());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> groupList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ContentItem 继承自 Groupie 库里的 Item 类如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ContentItem</span> <span class="keyword">extends</span> <span class="title">Item</span>&lt;<span class="title">ContentViewHolder</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ContentViewHolder <span class="title">createViewHolder</span><span class="params">(@NonNull View itemView)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ContentViewHolder(itemView);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">bind</span><span class="params">(@NonNull ContentViewHolder viewHolder, <span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">        viewHolder.setTitle();</span><br><span class="line">        viewHolder.setSubtitle();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getLayout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> R.layout.item_content;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>getLayout() 方法里传入定义的布局，bind() 里绑定相应的数据。同样，ContentViewHolder 继承自 Groupie 里的 ViewHolder 如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ContentViewHolder</span> <span class="keyword">extends</span> <span class="title">ViewHolder</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="keyword">private</span> TextView mTvTitle;</span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="keyword">private</span> TextView mTvSubtitle;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ContentViewHolder</span><span class="params">(@NonNull View rootView)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(rootView);</span><br><span class="line">        mTvTitle = rootView.findViewById(R.id.tv_title);</span><br><span class="line">        mTvSubtitle = rootView.findViewById(R.id.tv_subtitle);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTitle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mTvTitle.setText(<span class="string">"Hello Google"</span>);</span><br><span class="line">        mTvTitle.setTextSize(<span class="number">28</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSubtitle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mTvSubtitle.setText(<span class="string">"Hello Android"</span>);</span><br><span class="line">        mTvSubtitle.setTextSize(<span class="number">20</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>主要是作一些 View 层的操作。</p>
<p>运行程序如下：</p>
<p><img src="https://pic.superbed.cn/item/5c7bae6a3a213b041713d11c" alt=""></p>
<p>或许有人觉得，就一个简单的 RecyclerView 使用嘛，何必大动干戈，再来看看这张库的 Readme 图：</p>
<p><img src="https://pic.superbed.cn/item/5c7bae823a213b041713d2e0" alt=""></p>
<p>配套功能还是可以的，从简单使用着手，慢慢了解、熟悉乃至灵活应用，就可以应付我们开发中的大部分需求啦。当然，不能仅限于会使用，接下来跟进去，读读这个库 library 的源码。</p>
<h2 id="源码解读"><a href="#源码解读" class="headerlink" title="源码解读"></a><strong>源码解读</strong></h2><p>首先，看 Group 接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// adapter 里使用的一组 items</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Group</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取 item 的数目</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getItemCount</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="function">Item <span class="title">getItem</span><span class="params">(<span class="keyword">int</span> position)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取 item 的位置</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getPosition</span><span class="params">(@NonNull Item item)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注册组数据观察者</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">registerGroupDataObserver</span><span class="params">(@NonNull GroupDataObserver groupDataObserver)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注销组数据观察者</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">unregisterGroupDataObserver</span><span class="params">(@NonNull GroupDataObserver groupDataObserver)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再看所谓的组数据观察者 GroupDataObserver 接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">GroupDataObserver</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// 整个组变动</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onChanged</span><span class="params">(@NonNull Group group)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 组里某位置插入 item</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onItemInserted</span><span class="params">(@NonNull Group group, <span class="keyword">int</span> position)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 组里某位置 item 的变动</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onItemChanged</span><span class="params">(@NonNull Group group, <span class="keyword">int</span> position)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 组里某位置 item 负载对象的变动</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onItemChanged</span><span class="params">(@NonNull Group group, <span class="keyword">int</span> position, Object payload)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 组里某位置移除 item</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onItemRemoved</span><span class="params">(@NonNull Group group, <span class="keyword">int</span> position)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 组里某个范围 items 的变动</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onItemRangeChanged</span><span class="params">(@NonNull Group group, <span class="keyword">int</span> positionStart, <span class="keyword">int</span> itemCount)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 组里某个范围插入 items</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onItemRangeInserted</span><span class="params">(@NonNull Group group, <span class="keyword">int</span> positionStart, <span class="keyword">int</span> itemCount)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 组里某个范围移除 items</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onItemRangeRemoved</span><span class="params">(@NonNull Group group, <span class="keyword">int</span> positionStart, <span class="keyword">int</span> itemCount)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 组里某个范围移除 items</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onItemMoved</span><span class="params">(@NonNull Group group, <span class="keyword">int</span> fromPosition, <span class="keyword">int</span> toPosition)</span></span>;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>紧接着，看剩下的几个接口，SpanSizeProvider：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SpanSizeProvider</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取跨度大小</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getSpanSize</span><span class="params">(<span class="keyword">int</span> spanCount, <span class="keyword">int</span> position)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ExpandableItem 接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ExpandableItem</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置可展开的组</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setExpandableGroup</span><span class="params">(@NonNull ExpandableGroup onToggleListener)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后，就是两个 Listener 了，分别为普通的 item 点击 Listener 和 长点 Listener：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OnItemClickListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onItemClick</span><span class="params">(@NonNull Item item, @NonNull View view)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OnItemLongClickListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">onItemLongClick</span><span class="params">(@NonNull Item item, @NonNull View view)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>了解完相关的接口，接下来，<strong>重点看看一些类</strong>。先重点看 <strong>GroupAdapter</strong>，其持有 Group List，继承自 RecyclerView 的 Adapter：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GroupAdapter</span>&lt;<span class="title">VH</span> <span class="keyword">extends</span> <span class="title">ViewHolder</span>&gt; <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">Adapter</span>&lt;<span class="title">VH</span>&gt; <span class="keyword">implements</span> <span class="title">GroupDataObserver</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;Group&gt; groups = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> OnItemClickListener onItemClickListener;</span><br><span class="line">    <span class="keyword">private</span> OnItemLongClickListener onItemLongClickListener;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> spanCount = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> Item lastItemForViewTypeLookup;</span><br><span class="line">    <span class="comment">// 提供每个 item 占据的跨度数目</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> GridLayoutManager.SpanSizeLookup spanSizeLookup = <span class="keyword">new</span> GridLayoutManager.SpanSizeLookup() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSpanSize</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> getItem(position).getSpanSize(spanCount, position);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IndexOutOfBoundsException e) &#123;</span><br><span class="line">                <span class="keyword">return</span> spanCount;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在 item isClickable() 为 true 的地方注册点击监听器</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOnItemClickListener</span><span class="params">(@Nullable OnItemClickListener onItemClickListener)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.onItemClickListener = onItemClickListener;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 同理，在 item isLongClickable() 为 true 的地方注册长点击监听器</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOnItemLongClickListener</span><span class="params">(@Nullable OnItemLongClickListener onItemLongClickListener)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.onItemLongClickListener = onItemLongClickListener;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> VH <span class="title">onCreateViewHolder</span><span class="params">(@NonNull ViewGroup parent, <span class="keyword">int</span> layoutResId)</span> </span>&#123;</span><br><span class="line">        LayoutInflater inflater = LayoutInflater.from(parent.getContext());</span><br><span class="line">        <span class="comment">// 根据 layoutResId 获取给定 ViewType 的 item</span></span><br><span class="line">        Item&lt;VH&gt; item = getItemForViewType(layoutResId);</span><br><span class="line">        View itemView = inflater.inflate(layoutResId, parent, <span class="keyword">false</span>);</span><br><span class="line">        <span class="keyword">return</span> item.createViewHolder(itemView);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBindViewHolder</span><span class="params">(@NonNull VH holder, <span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBindViewHolder</span><span class="params">(@NonNull VH holder, <span class="keyword">int</span> position, @NonNull List&lt;Object&gt; payloads)</span> </span>&#123;</span><br><span class="line">        Item contentItem = getItem(position);</span><br><span class="line">        contentItem.bind(holder, position, payloads, onItemClickListener, onItemLongClickListener);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onViewRecycled</span><span class="params">(@NonNull VH holder)</span> </span>&#123;</span><br><span class="line">        Item contentItem = holder.getItem();</span><br><span class="line">        <span class="comment">// 数据解绑</span></span><br><span class="line">        contentItem.unbind(holder);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onFailedToRecycleView</span><span class="params">(@NonNull VH holder)</span> </span>&#123;</span><br><span class="line">        Item contentItem = holder.getItem();</span><br><span class="line">        <span class="comment">// 可回收 contentItem</span></span><br><span class="line">        <span class="keyword">return</span> contentItem.isRecyclable();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getItemViewType</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">        lastItemForViewTypeLookup = getItem(position);</span><br><span class="line">        <span class="keyword">if</span> (lastItemForViewTypeLookup == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Invalid position "</span> + position);</span><br><span class="line">        <span class="keyword">return</span> lastItemForViewTypeLookup.getLayout();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Item <span class="title">getItem</span><span class="params">(@NonNull VH holder)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> holder.getItem();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Item <span class="title">getItem</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (Group group : groups) &#123;</span><br><span class="line">            <span class="keyword">if</span> (position &lt; count + group.getItemCount()) &#123;</span><br><span class="line">                <span class="keyword">return</span> group.getItem(position - count);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                count += group.getItemCount();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IndexOutOfBoundsException(<span class="string">"Requested position "</span> + position + <span class="string">"in group adapter "</span> +</span><br><span class="line">                <span class="string">"but there are only "</span> + count + <span class="string">" items"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAdapterPosition</span><span class="params">(@NonNull Item contentItem)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (Group group : groups) &#123;</span><br><span class="line">            <span class="keyword">int</span> index = group.getPosition(contentItem);</span><br><span class="line">            <span class="keyword">if</span> (index &gt;= <span class="number">0</span>) <span class="keyword">return</span> index + count;</span><br><span class="line">            count += group.getItemCount();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 展开 list 中组开始 item 的位置</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAdapterPosition</span><span class="params">(@NonNull Group group)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> index = groups.indexOf(group);</span><br><span class="line">        <span class="keyword">int</span> position = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; index; i++) &#123;</span><br><span class="line">            position += groups.get(i).getItemCount();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> position;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getItemCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (Group group : groups) &#123;</span><br><span class="line">            count += group.getItemCount();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getItemCount</span><span class="params">(<span class="keyword">int</span> groupIndex)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (groupIndex &gt;= groups.size()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IndexOutOfBoundsException(<span class="string">"Requested group index "</span> + groupIndex + <span class="string">" but there are "</span> + groups.size() + <span class="string">" groups"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> groups.get(groupIndex).getItemCount();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 清除操作</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Group group : groups) &#123;</span><br><span class="line">            group.registerGroupDataObserver(<span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        groups.clear();</span><br><span class="line">        <span class="comment">// 原生的，通知注册的观察者数据集发生变化</span></span><br><span class="line">        notifyDataSetChanged();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加组</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(@NonNull Group group)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (group == <span class="keyword">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Group cannot be null"</span>);</span><br><span class="line">        <span class="keyword">int</span> itemCountBeforeGroup = getItemCount();</span><br><span class="line">        group.registerGroupDataObserver(<span class="keyword">this</span>);</span><br><span class="line">        groups.add(group);</span><br><span class="line">        notifyItemRangeInserted(itemCountBeforeGroup, group.getItemCount());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 顺序添加组列表的内容，list 中的组须是非空的</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addAll</span><span class="params">(@NonNull Collection&lt;? extends Group&gt; groups)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (groups.contains(<span class="keyword">null</span>)) <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"List of groups can't contain null!"</span>);</span><br><span class="line">        <span class="keyword">int</span> itemCountBeforeGroup = getItemCount();</span><br><span class="line">        <span class="keyword">int</span> additionalSize = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (Group group : groups) &#123;</span><br><span class="line">            additionalSize += group.getItemCount();</span><br><span class="line">            group.registerGroupDataObserver(<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.groups.addAll(groups);</span><br><span class="line">        notifyItemRangeInserted(itemCountBeforeGroup, additionalSize);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ... 一些移除操作的方法</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(@NonNull <span class="keyword">int</span> index, Group group)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (group == <span class="keyword">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Group cannot be null"</span>);</span><br><span class="line">        group.registerGroupDataObserver(<span class="keyword">this</span>);</span><br><span class="line">        groups.add(index, group);</span><br><span class="line">        <span class="keyword">int</span> itemCountBeforeGroup = getItemCountBeforeGroup(index);</span><br><span class="line">        notifyItemRangeInserted(itemCountBeforeGroup, group.getItemCount());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取列表中组的位置</span></span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Group <span class="title">getGroup</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> previous = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> size;</span><br><span class="line">        <span class="keyword">for</span> (Group group : groups) &#123;</span><br><span class="line">            size = group.getItemCount();</span><br><span class="line">            <span class="keyword">if</span> (position - previous &lt; size) <span class="keyword">return</span> group;</span><br><span class="line">            previous += group.getItemCount();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IndexOutOfBoundsException(<span class="string">"Requested position "</span> + position + <span class="string">"in group adapter "</span> +</span><br><span class="line">                <span class="string">"but there are only "</span> + previous + <span class="string">" items"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ... 组操作</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onChanged</span><span class="params">(@NonNull Group group)</span> </span>&#123;</span><br><span class="line">        notifyItemRangeChanged(getAdapterPosition(group), group.getItemCount());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ... item 变动操作</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onItemMoved</span><span class="params">(@NonNull Group group, <span class="keyword">int</span> fromPosition, <span class="keyword">int</span> toPosition)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> groupAdapterPosition = getAdapterPosition(group);</span><br><span class="line">        notifyItemMoved(groupAdapterPosition + fromPosition, groupAdapterPosition + toPosition);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 找到给定视图类型的 model，再为其创建 viewholder，依赖 RecyclerView 的实现细节，</span></span><br><span class="line">    <span class="comment">// getItemViewType() 在 onCreateViewHolder() 之前调用。对查找过的视图类型作缓存，</span></span><br><span class="line">    <span class="comment">// 除非实现变化了，否则希望能快速到相应的 model。为了保障安全，折中查找所有匹配视图类型</span></span><br><span class="line">    <span class="comment">// 的 model，虽然慢且或许不必要，但却是 RecyclerView 行为变化的保障</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Item&lt;VH&gt; <span class="title">getItemForViewType</span><span class="params">(@LayoutRes <span class="keyword">int</span> layoutResId)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 是最后查找 ViewType 的 item</span></span><br><span class="line">        <span class="keyword">if</span> (lastItemForViewTypeLookup != <span class="keyword">null</span></span><br><span class="line">                &amp;&amp; lastItemForViewTypeLookup.getLayout() == layoutResId) &#123;</span><br><span class="line">            <span class="comment">// We expect this to be a hit 100% of the time</span></span><br><span class="line">            <span class="keyword">return</span> lastItemForViewTypeLookup;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 保障 RecyclerView 实现细节变化时的安全</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; getItemCount(); i++) &#123;</span><br><span class="line">            Item item = getItem(i);</span><br><span class="line">            <span class="keyword">if</span> (item.getLayout() == layoutResId) &#123;</span><br><span class="line">                <span class="keyword">return</span> item;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Could not find model for view type: "</span> + layoutResId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再看我们 ContentItem 所继承的 <strong>Item</strong>，其实现了前文的 Group 和 SpanSizeProvider 接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Item</span>&lt;<span class="title">VH</span> <span class="keyword">extends</span> <span class="title">ViewHolder</span>&gt; <span class="keyword">implements</span> <span class="title">Group</span>, <span class="title">SpanSizeProvider</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> AtomicLong ID_COUNTER = <span class="keyword">new</span> AtomicLong(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">protected</span> GroupDataObserver parentDataObserver;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> id;</span><br><span class="line">    <span class="comment">// ViewHolder 里存储的键值对集，以利于区分同样视图类型的 items</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Object&gt; extras = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Item</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(ID_COUNTER.decrementAndGet());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="title">Item</span><span class="params">(<span class="keyword">long</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> VH <span class="title">createViewHolder</span><span class="params">(@NonNull View itemView)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (VH) <span class="keyword">new</span> ViewHolder(itemView);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@CallSuper</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">bind</span><span class="params">(@NonNull VH holder, <span class="keyword">int</span> position, @NonNull List&lt;Object&gt; payloads,</span><br><span class="line">                     @Nullable OnItemClickListener onItemClickListener,</span><br><span class="line">                     @Nullable OnItemLongClickListener onItemLongClickListener)</span> </span>&#123;</span><br><span class="line">        holder.bind(<span class="keyword">this</span>, onItemClickListener, onItemLongClickListener);</span><br><span class="line">        bind(holder, position, payloads);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">bind</span><span class="params">(@NonNull VH viewHolder, <span class="keyword">int</span> position)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 不在实现里指定如何处理 payloads 的话，其将被忽略，且 adapter 作全面的重新绑定</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">bind</span><span class="params">(@NonNull VH holder, <span class="keyword">int</span> position, @NonNull List&lt;Object&gt; payloads)</span> </span>&#123;</span><br><span class="line">        bind(holder, position);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 作清理以求 viewholder 被重用</span></span><br><span class="line">    <span class="meta">@CallSuper</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unbind</span><span class="params">(@NonNull VH holder)</span> </span>&#123;</span><br><span class="line">        holder.unbind();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isRecyclable</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ... 一些 get 操作</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerGroupDataObserver</span><span class="params">(@NonNull GroupDataObserver groupDataObserver)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.parentDataObserver = groupDataObserver;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unregisterGroupDataObserver</span><span class="params">(@NonNull GroupDataObserver groupDataObserver)</span> </span>&#123;</span><br><span class="line">        parentDataObserver = <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPosition</span><span class="params">(@NonNull Item item)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span> == item ? <span class="number">0</span> : -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isClickable</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isLongClickable</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">notifyChanged</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (parentDataObserver != <span class="keyword">null</span>) &#123;</span><br><span class="line">            parentDataObserver.onItemChanged(<span class="keyword">this</span>, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">notifyChanged</span><span class="params">(@Nullable Object payload)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (parentDataObserver != <span class="keyword">null</span>) &#123;</span><br><span class="line">            parentDataObserver.onItemChanged(<span class="keyword">this</span>, <span class="number">0</span>, payload);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ViewHolder 里存储的键值对集，以利于区分同样视图类型的 items</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">getExtras</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> extras;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 若不指定 id，则每个 item 会自动生成一个特殊的负值 id，几乎不会与 model IDs 冲突。</span></span><br><span class="line">    <span class="comment">// 最好重写其，给定一个 model 对象的 id，比如数据库中一个对象代表的基键，用来判定同样</span></span><br><span class="line">    <span class="comment">// 视图类型的 items，在使用 DiffUtil 的比较下，是否真正相同。</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接着看 <strong>ViewHolder</strong>，其继承自 RecyclerView 的 ViewHolder：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewHolder</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">ViewHolder</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Item item;</span><br><span class="line">    <span class="keyword">private</span> OnItemClickListener onItemClickListener;</span><br><span class="line">    <span class="keyword">private</span> OnItemLongClickListener onItemLongClickListener;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> View.OnClickListener onClickListener = <span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(@NonNull View v)</span> </span>&#123;</span><br><span class="line">            <span class="comment">// viewholder 被移除则放弃点击，但仍然在点击移除的动画过程中</span></span><br><span class="line">            <span class="keyword">if</span> (onItemClickListener != <span class="keyword">null</span> &amp;&amp; getAdapterPosition() != RecyclerView.NO_POSITION) &#123;</span><br><span class="line">                onItemClickListener.onItemClick(getItem(), v);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> View.OnLongClickListener onLongClickListener = <span class="keyword">new</span> View.OnLongClickListener() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onLongClick</span><span class="params">(@NonNull View v)</span> </span>&#123;</span><br><span class="line">            <span class="comment">// viewholder 被移除则放弃长点击，但仍然在长点击移除的动画过程中</span></span><br><span class="line">            <span class="keyword">if</span> (onItemLongClickListener != <span class="keyword">null</span> &amp;&amp; getAdapterPosition() != RecyclerView.NO_POSITION) &#123;</span><br><span class="line">                <span class="keyword">return</span> onItemLongClickListener.onItemLongClick(getItem(), v);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ViewHolder</span><span class="params">(@NonNull View rootView)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(rootView);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">bind</span><span class="params">(@NonNull Item item, @Nullable OnItemClickListener onItemClickListener, @Nullable OnItemLongClickListener onItemLongClickListener)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.item = item;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 只设置顶层的点击监听器当其存在，且点击 enabled，这确保不会和用户设置的点击监听器</span></span><br><span class="line">        <span class="comment">// 产生干扰。最好将监听器设置为总是 attached，在创建 viewholder 时再设置监听器，但是</span></span><br><span class="line">        <span class="comment">// 要注意的是，同样布局类型的不同 items 无法有着同样的点击监听器，设置决定是否是可以点击的。</span></span><br><span class="line">        <span class="keyword">if</span> (onItemClickListener != <span class="keyword">null</span> &amp;&amp; item.isClickable()) &#123;</span><br><span class="line">            itemView.setOnClickListener(onClickListener);</span><br><span class="line">            <span class="keyword">this</span>.onItemClickListener = onItemClickListener;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (onItemLongClickListener != <span class="keyword">null</span> &amp;&amp; item.isLongClickable()) &#123;</span><br><span class="line">            itemView.setOnLongClickListener(onLongClickListener);</span><br><span class="line">            <span class="keyword">this</span>.onItemLongClickListener = onItemLongClickListener;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unbind</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 先前设置监听器的话，此处将顶级的点击监听器设置为 null，避免取消任何点击监听器，</span></span><br><span class="line">        <span class="comment">// 用户或许会设置其为和 viewholder 生命周期一致</span></span><br><span class="line">        <span class="keyword">if</span> (onItemClickListener != <span class="keyword">null</span> &amp;&amp; item.isClickable()) &#123;</span><br><span class="line">            itemView.setOnClickListener(<span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (onItemLongClickListener != <span class="keyword">null</span> &amp;&amp; item.isLongClickable()) &#123;</span><br><span class="line">            itemView.setOnLongClickListener(<span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.item = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">this</span>.onItemClickListener = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">this</span>.onItemLongClickListener = <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ... 一些 get 操作</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Demo 中常用的 GroupAdapter、Item 和 ViewHolder 介绍完毕，延伸来看实现 Group 和 GroupDataObserver 接口的 NestedGroup：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 支持 Groups 随意深度的嵌套，可以使得嵌套 Group 只包含 items，其包含 Groups 或混合物</span></span><br><span class="line"><span class="comment">// 此外，其提供子 groups 发生变化传送给 adapter 的通知。</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">NestedGroup</span> <span class="keyword">implements</span> <span class="title">Group</span>, <span class="title">GroupDataObserver</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> GroupDataObservable observable = <span class="keyword">new</span> GroupDataObservable();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getItemCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> size = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; getGroupCount(); i++) &#123;</span><br><span class="line">            Group group = getGroup(i);</span><br><span class="line">            size += group.getItemCount();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ... 一些 get 操作</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Item <span class="title">getItem</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> previousPosition = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; getGroupCount(); i++) &#123;</span><br><span class="line">            Group group = getGroup(i);</span><br><span class="line">            <span class="keyword">int</span> size = group.getItemCount();</span><br><span class="line">            <span class="keyword">if</span> (size + previousPosition &gt; position) &#123;</span><br><span class="line">                <span class="keyword">return</span> group.getItem(position - previousPosition);</span><br><span class="line">            &#125;</span><br><span class="line">            previousPosition += size;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IndexOutOfBoundsException(<span class="string">"Wanted item at "</span> + position + <span class="string">" but there are only "</span></span><br><span class="line">                + getItemCount() + <span class="string">" items"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">getPosition</span><span class="params">(@NonNull Item item)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> previousPosition = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; getGroupCount(); i++) &#123;</span><br><span class="line">            Group group = getGroup(i);</span><br><span class="line">            <span class="keyword">int</span> position = group.getPosition(item);</span><br><span class="line">            <span class="keyword">if</span> (position &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> position + previousPosition;</span><br><span class="line">            &#125;</span><br><span class="line">            previousPosition += group.getItemCount();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">int</span> <span class="title">getPosition</span><span class="params">(@NonNull Group group)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">registerGroupDataObserver</span><span class="params">(@NonNull GroupDataObserver groupDataObserver)</span> </span>&#123;</span><br><span class="line">        observable.registerObserver(groupDataObserver);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unregisterGroupDataObserver</span><span class="params">(@NonNull GroupDataObserver groupDataObserver)</span> </span>&#123;</span><br><span class="line">        observable.unregisterObserver(groupDataObserver);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@CallSuper</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(@NonNull Group group)</span> </span>&#123;</span><br><span class="line">        group.registerGroupDataObserver(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ... 一些添加操作</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@CallSuper</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addAll</span><span class="params">(<span class="keyword">int</span> position, @NonNull Collection&lt;? extends Group&gt; groups)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Group group : groups) &#123;</span><br><span class="line">            group.registerGroupDataObserver(<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@CallSuper</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(@NonNull Group group)</span> </span>&#123;</span><br><span class="line">        group.unregisterGroupDataObserver(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@CallSuper</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeAll</span><span class="params">(@NonNull Collection&lt;? extends Group&gt; groups)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Group group : groups) &#123;</span><br><span class="line">            group.unregisterGroupDataObserver(<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// group 里的 item 仍然存在，但其数据发生了变化</span></span><br><span class="line">    <span class="meta">@CallSuper</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onChanged</span><span class="params">(@NonNull Group group)</span> </span>&#123;</span><br><span class="line">        observable.onItemRangeChanged(<span class="keyword">this</span>, getItemCountBeforeGroup(group), group.getItemCount());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ... </span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@CallSuper</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onItemMoved</span><span class="params">(@NonNull Group group, <span class="keyword">int</span> fromPosition, <span class="keyword">int</span> toPosition)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> groupPosition = getItemCountBeforeGroup(group);</span><br><span class="line">        observable.onItemMoved(<span class="keyword">this</span>, groupPosition + fromPosition, groupPosition + toPosition);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// group 使用该方法通知其自己发生了变化</span></span><br><span class="line">    <span class="meta">@CallSuper</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">notifyItemRangeInserted</span><span class="params">(<span class="keyword">int</span> positionStart, <span class="keyword">int</span> itemCount)</span> </span>&#123;</span><br><span class="line">        observable.onItemRangeInserted(<span class="keyword">this</span>, positionStart, itemCount);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@CallSuper</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">notifyItemRangeChanged</span><span class="params">(<span class="keyword">int</span> positionStart, <span class="keyword">int</span> itemCount)</span> </span>&#123;</span><br><span class="line">        observable.onItemRangeChanged(<span class="keyword">this</span>, positionStart, itemCount);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 反序迭代以防任一观察者在它们的回调中决定移除其自身</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">GroupDataObservable</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> List&lt;GroupDataObserver&gt; observers = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ... 一些变动操作</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">registerObserver</span><span class="params">(GroupDataObserver observer)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (observers) &#123;</span><br><span class="line">                <span class="keyword">if</span> (observers.contains(observer)) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Observer "</span> + observer + <span class="string">" is already registered."</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                observers.add(observer);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">unregisterObserver</span><span class="params">(GroupDataObserver observer)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (observers) &#123;</span><br><span class="line">                <span class="keyword">int</span> index = observers.indexOf(observer);</span><br><span class="line">                observers.remove(index);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再看继承自嵌套 Group 的 Section：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Section</span> <span class="keyword">extends</span> <span class="title">NestedGroup</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">private</span> Group header;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">private</span> Group footer;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">private</span> Group placeholder;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ArrayList&lt;Group&gt; children = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> hideWhenEmpty = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isHeaderAndFooterVisible = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isPlaceholderVisible = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Section</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(<span class="keyword">null</span>, <span class="keyword">new</span> ArrayList&lt;Group&gt;());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Section</span><span class="params">(@Nullable Group header, @NonNull Collection&lt;? extends Group&gt; children)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.header = header;</span><br><span class="line">        addAll(children);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> position, @NonNull Group group)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.add(position, group);</span><br><span class="line">        children.add(position, group);</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> notifyPosition = getHeaderItemCount() + getItemCount(children.subList(<span class="number">0</span>, position));</span><br><span class="line">        notifyItemRangeInserted(notifyPosition, group.getItemCount());</span><br><span class="line">        refreshEmptyState();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ... add() 操作</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(@NonNull Group group)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.add(group);</span><br><span class="line">        <span class="keyword">int</span> position = getItemCountWithoutFooter();</span><br><span class="line">        children.add(group);</span><br><span class="line">        notifyItemRangeInserted(position, group.getItemCount());</span><br><span class="line">        refreshEmptyState();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(@NonNull Group group)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.remove(group);</span><br><span class="line">        <span class="keyword">int</span> position = getItemCountBeforeGroup(group);</span><br><span class="line">        children.remove(group);</span><br><span class="line">        notifyItemRangeRemoved(position, group.getItemCount());</span><br><span class="line">        refreshEmptyState();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ... </span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// section's body 为空时设置 placeholder</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPlaceholder</span><span class="params">(@NonNull Group placeholder)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (placeholder == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"Placeholder can't be null.  Please use removePlaceholder() instead!"</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.placeholder != <span class="keyword">null</span>) &#123;</span><br><span class="line">            removePlaceholder();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.placeholder = placeholder;</span><br><span class="line">        refreshEmptyState();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removePlaceholder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        hidePlaceholder();</span><br><span class="line">        <span class="keyword">this</span>.placeholder = <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">showPlaceholder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (isPlaceholderVisible || placeholder == <span class="keyword">null</span>) <span class="keyword">return</span>;</span><br><span class="line">        isPlaceholderVisible = <span class="keyword">true</span>;</span><br><span class="line">        notifyItemRangeInserted(getHeaderItemCount(), placeholder.getItemCount());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">hidePlaceholder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!isPlaceholderVisible || placeholder == <span class="keyword">null</span>) <span class="keyword">return</span>;</span><br><span class="line">        isPlaceholderVisible = <span class="keyword">false</span>;</span><br><span class="line">        notifyItemRangeRemoved(getHeaderItemCount(), placeholder.getItemCount());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> children.isEmpty() || getItemCount(children) == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">hideDecorations</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!isHeaderAndFooterVisible &amp;&amp; !isPlaceholderVisible) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">int</span> count = getHeaderItemCount() + getPlaceholderItemCount() + getFooterItemCount();</span><br><span class="line">        isHeaderAndFooterVisible = <span class="keyword">false</span>;</span><br><span class="line">        isPlaceholderVisible = <span class="keyword">false</span>;</span><br><span class="line">        notifyItemRangeRemoved(<span class="number">0</span>, count);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">refreshEmptyState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> isEmpty = isEmpty();</span><br><span class="line">        <span class="keyword">if</span> (isEmpty) &#123;</span><br><span class="line">            <span class="keyword">if</span> (hideWhenEmpty) &#123;</span><br><span class="line">                hideDecorations();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                showPlaceholder();</span><br><span class="line">                showHeadersAndFooters();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            hidePlaceholder();</span><br><span class="line">            showHeadersAndFooters();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">showHeadersAndFooters</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (isHeaderAndFooterVisible) <span class="keyword">return</span>;</span><br><span class="line">        isHeaderAndFooterVisible = <span class="keyword">true</span>;</span><br><span class="line">        notifyItemRangeInserted(<span class="number">0</span>, getHeaderItemCount());</span><br><span class="line">        notifyItemRangeInserted(getItemCountWithoutFooter(), getFooterItemCount());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">getBodyItemCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> isPlaceholderVisible ? getPlaceholderItemCount() : getItemCount(children);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ... 一些 get 数目操作</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">getPlaceholderCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> isPlaceholderVisible ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Group <span class="title">getGroup</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (isHeaderShown() &amp;&amp; position == <span class="number">0</span>) <span class="keyword">return</span> header;</span><br><span class="line">        position -= getHeaderCount();</span><br><span class="line">        <span class="keyword">if</span> (isPlaceholderShown() &amp;&amp; position == <span class="number">0</span>) <span class="keyword">return</span> placeholder;</span><br><span class="line">        position -= getPlaceholderCount();</span><br><span class="line">        <span class="keyword">if</span> (position == children.size()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (isFooterShown()) &#123;</span><br><span class="line">                <span class="keyword">return</span> footer;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IndexOutOfBoundsException(<span class="string">"Wanted group at position "</span> + position +</span><br><span class="line">                        <span class="string">" but there are only "</span> + getGroupCount() + <span class="string">" groups"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> children.get(position);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getGroupCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getHeaderCount() + getFooterCount() + getPlaceholderCount() + children.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPosition</span><span class="params">(@NonNull Group group)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (isHeaderShown()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (group == header) <span class="keyword">return</span> count;</span><br><span class="line">        &#125;</span><br><span class="line">        count += getHeaderCount();</span><br><span class="line">        <span class="keyword">if</span> (isPlaceholderShown()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (group == placeholder) <span class="keyword">return</span> count;</span><br><span class="line">        &#125;</span><br><span class="line">        count += getPlaceholderCount();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> index = children.indexOf(group);</span><br><span class="line">        <span class="keyword">if</span> (index &gt;= <span class="number">0</span>) <span class="keyword">return</span> count + index;</span><br><span class="line">        count += children.size();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (isFooterShown()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (footer == group) &#123;</span><br><span class="line">                <span class="keyword">return</span> count;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// header, footer 和 placeholder 是否显示的布尔方法</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// header 操作</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHeader</span><span class="params">(@NonNull Group header)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (header == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"Header can't be null.  Please use removeHeader() instead!"</span>);</span><br><span class="line">        <span class="keyword">int</span> previousHeaderItemCount = getHeaderItemCount();</span><br><span class="line">        <span class="keyword">this</span>.header = header;</span><br><span class="line">        notifyHeaderItemsChanged(previousHeaderItemCount);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeHeader</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> previousHeaderItemCount = getHeaderItemCount();</span><br><span class="line">        <span class="keyword">this</span>.header = <span class="keyword">null</span>;</span><br><span class="line">        notifyHeaderItemsChanged(previousHeaderItemCount);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">notifyHeaderItemsChanged</span><span class="params">(<span class="keyword">int</span> previousHeaderItemCount)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> newHeaderItemCount = getHeaderItemCount();</span><br><span class="line">        <span class="keyword">if</span> (previousHeaderItemCount &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            notifyItemRangeRemoved(<span class="number">0</span>, previousHeaderItemCount);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (newHeaderItemCount &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            notifyItemRangeInserted(<span class="number">0</span>, newHeaderItemCount);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// footer 操作</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFooter</span><span class="params">(@NonNull Group footer)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (footer == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"Footer can't be null.  Please use removeFooter() instead!"</span>);</span><br><span class="line">        <span class="keyword">int</span> previousFooterItemCount = getFooterItemCount();</span><br><span class="line">        <span class="keyword">this</span>.footer = footer;</span><br><span class="line">        notifyFooterItemsChanged(previousFooterItemCount);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeFooter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> previousFooterItemCount = getFooterItemCount();</span><br><span class="line">        <span class="keyword">this</span>.footer = <span class="keyword">null</span>;</span><br><span class="line">        notifyFooterItemsChanged(previousFooterItemCount);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">notifyFooterItemsChanged</span><span class="params">(<span class="keyword">int</span> previousFooterItemCount)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> newFooterItemCount = getFooterItemCount();</span><br><span class="line">        <span class="keyword">if</span> (previousFooterItemCount &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            notifyItemRangeRemoved(getItemCountWithoutFooter(), previousFooterItemCount);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (newFooterItemCount &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            notifyItemRangeInserted(getItemCountWithoutFooter(), newFooterItemCount);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ... item 变动方法</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同样看看继承自嵌套 Group 的可展开的 ExpandableGroup：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExpandableGroup</span> <span class="keyword">extends</span> <span class="title">NestedGroup</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isExpanded = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Group parent;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;Group&gt; children = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ExpandableGroup</span><span class="params">(Group expandableItem)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.parent = expandableItem;</span><br><span class="line">        ((ExpandableItem) expandableItem).setExpandableGroup(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ExpandableGroup</span><span class="params">(Group expandableItem, <span class="keyword">boolean</span> isExpanded)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.parent = expandableItem;</span><br><span class="line">        ((ExpandableItem) expandableItem).setExpandableGroup(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">this</span>.isExpanded = isExpanded;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(@NonNull Group group)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.add(group);</span><br><span class="line">        <span class="keyword">if</span> (isExpanded) &#123;</span><br><span class="line">            <span class="keyword">int</span> itemCount = getItemCount();</span><br><span class="line">            children.add(group);</span><br><span class="line">            notifyItemRangeInserted(itemCount, group.getItemCount());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            children.add(group);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addAll</span><span class="params">(@NonNull Collection&lt;? extends Group&gt; groups)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (groups.isEmpty()) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">super</span>.addAll(groups);</span><br><span class="line">        <span class="keyword">if</span> (isExpanded) &#123;</span><br><span class="line">            <span class="keyword">int</span> itemCount = getItemCount();</span><br><span class="line">            <span class="keyword">this</span>.children.addAll(groups);</span><br><span class="line">            notifyItemRangeInserted(itemCount, getItemCount(groups));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.children.addAll(groups);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addAll</span><span class="params">(<span class="keyword">int</span> position, @NonNull Collection&lt;? extends Group&gt; groups)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (groups.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">super</span>.addAll(position, groups);</span><br><span class="line">        <span class="keyword">if</span> (isExpanded) &#123;</span><br><span class="line">            <span class="keyword">int</span> itemCount = getItemCount();</span><br><span class="line">            <span class="keyword">this</span>.children.addAll(position, groups);</span><br><span class="line">            notifyItemRangeInserted(itemCount, getItemCount(groups));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.children.addAll(position, groups);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isExpanded</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> isExpanded;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Group <span class="title">getGroup</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (position == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> parent;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> children.get(position - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPosition</span><span class="params">(@NonNull Group group)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (group == parent) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span> + children.indexOf(group);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getGroupCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span> + (isExpanded ? children.size() : <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 触发展开</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onToggleExpanded</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> oldSize = getItemCount();</span><br><span class="line">        isExpanded = !isExpanded;</span><br><span class="line">        <span class="keyword">int</span> newSize = getItemCount();</span><br><span class="line">        <span class="keyword">if</span> (oldSize &gt; newSize) &#123;</span><br><span class="line">            notifyItemRangeRemoved(newSize, oldSize - newSize);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            notifyItemRangeInserted(oldSize, newSize - oldSize);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">dispatchChildChanges</span><span class="params">(Group group)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> isExpanded || group == parent;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ... item 变动的一些方法</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>还有继承自嵌套 Group 的 UpdatingGroup：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 接受一列表 items 的 group，其和之前的内容不同，生成相应的移除、添加、移动和变动通知给其父观察者，</span></span><br><span class="line"><span class="comment">// 创建带动效的 item 层更新。(1) 通过 Item.getId() 判断 items 是否相同；(2) 通过 Item.equals() </span></span><br><span class="line"><span class="comment">// 判断内容是否相同。若未自定义 getId() 和 equals() 方法，则默认的实现将返回 false，意味着 Group </span></span><br><span class="line"><span class="comment">// 考虑每一完整事项的更新。</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UpdatingGroup</span> <span class="keyword">extends</span> <span class="title">NestedGroup</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// List 更新回调</span></span><br><span class="line">    <span class="keyword">private</span> ListUpdateCallback listUpdateCallback = <span class="keyword">new</span> ListUpdateCallback() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onInserted</span><span class="params">(<span class="keyword">int</span> position, <span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line">            notifyItemRangeInserted(position, count);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onRemoved</span><span class="params">(<span class="keyword">int</span> position, <span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line">            notifyItemRangeRemoved(position, count);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMoved</span><span class="params">(<span class="keyword">int</span> fromPosition, <span class="keyword">int</span> toPosition)</span> </span>&#123;</span><br><span class="line">            notifyItemMoved(fromPosition, toPosition);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onChanged</span><span class="params">(<span class="keyword">int</span> position, <span class="keyword">int</span> count, Object payload)</span> </span>&#123;</span><br><span class="line">            notifyItemRangeChanged(position, count);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;Item&gt; items = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(@NonNull List&lt;? extends Item&gt; newItems)</span> </span>&#123;</span><br><span class="line">        DiffUtil.DiffResult diffResult = DiffUtil.calculateDiff(<span class="keyword">new</span> UpdatingCallback(newItems));</span><br><span class="line">        <span class="keyword">super</span>.removeAll(items);</span><br><span class="line">        items.clear();</span><br><span class="line">        <span class="keyword">super</span>.addAll(newItems);</span><br><span class="line">        items.addAll(newItems);</span><br><span class="line">        diffResult.dispatchUpdatesTo(listUpdateCallback);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Group <span class="title">getGroup</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> items.get(position);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getGroupCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> items.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPosition</span><span class="params">(@NonNull Group group)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (group <span class="keyword">instanceof</span> Item) &#123;</span><br><span class="line">            <span class="keyword">return</span> items.indexOf(group);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更新回调</span></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">UpdatingCallback</span> <span class="keyword">extends</span> <span class="title">DiffUtil</span>.<span class="title">Callback</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> List&lt;? extends Item&gt; newList;</span><br><span class="line"></span><br><span class="line">        UpdatingCallback(List&lt;? extends Item&gt; newList) &#123;</span><br><span class="line">            <span class="keyword">this</span>.newList = newList;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getOldListSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> items.size();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getNewListSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> newList.size();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">areItemsTheSame</span><span class="params">(<span class="keyword">int</span> oldItemPosition, <span class="keyword">int</span> newItemPosition)</span> </span>&#123;</span><br><span class="line">            Item oldItem = items.get(oldItemPosition);</span><br><span class="line">            Item newItem = newList.get(newItemPosition);</span><br><span class="line">            <span class="keyword">if</span> (oldItem.getLayout() != newItem.getLayout()) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> oldItem.getId() == newItem.getId();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">areContentsTheSame</span><span class="params">(<span class="keyword">int</span> oldItemPosition, <span class="keyword">int</span> newItemPosition)</span> </span>&#123;</span><br><span class="line">            Item oldItem = items.get(oldItemPosition);</span><br><span class="line">            Item newItem = newList.get(newItemPosition);</span><br><span class="line">            <span class="keyword">return</span> oldItem.equals(newItem);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后的最后，是一个触碰回调类 TouchCallback：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">TouchCallback</span> <span class="keyword">extends</span> <span class="title">ItemTouchHelper</span>.<span class="title">SimpleCallback</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TouchCallback</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSwipeDirs</span><span class="params">(@NonNull RecyclerView recyclerView, @NonNull RecyclerView.ViewHolder viewHolder)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 调用 ViewHolder 里的方法</span></span><br><span class="line">        <span class="keyword">return</span> ((ViewHolder) viewHolder).getSwipeDirs();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getDragDirs</span><span class="params">(@NonNull RecyclerView recyclerView, @NonNull RecyclerView.ViewHolder viewHolder)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 调用 ViewHolder 里的方法</span></span><br><span class="line">        <span class="keyword">return</span> ((ViewHolder) viewHolder).getDragDirs();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>至此，第三方库 Groupie 的简单解读到此完毕。</p>
<p><strong><em>本人才疏学浅，如有疏漏错误之处，望读者中有识之士不吝赐教，谢谢。</em></strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Email: iamasoldiersix@gmail.com / WeChat: Wolverine623</span><br></pre></td></tr></table></figure>
<p><strong><em>您也可以关注我个人的微信公众号</em></strong> ：<strong><em>码农六哥</em></strong>，<strong><em>第一时间获得博客的更新通知，或后台留言与我交流</em></strong>。</p>
<p><img src="https://i.loli.net/2019/03/03/5c7b80d4d728b.jpg" alt=""></p>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/12/03/深入-Java-中的-HashMap-一/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          深入 Java 中的 HashMap (一)
        
      </div>
    </a>
  
  
    <a href="/2017/11/03/Android-图片加载之浅谈-Glide/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">Android 图片加载之浅谈 Glide</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  

  
  <! -- 添加捐赠图标 -->
<div class ="post-donate">
    <div id="donate_board" class="donate_bar center">
        <a id="btn_donate" class="btn_donate" href="javascript:;" title="打赏"></a>
        <span class="donate_txt">
           &uarr;<br>
		   左边支付宝打赏，右边微信打赏。
        </span>
        <br>
      </div>  
	<div id="donate_guide" class="donate_bar center hidden" >
		<!-- 支付宝打赏图案 -->
		<img src="https://pic.superbed.cn/item/5c7bba683a213b041714b52b" alt="支付宝打赏"> 
		<!-- 微信打赏图案 -->
		<img src="https://pic.superbed.cn/item/5c7bbb573a213b041714c6e0" alt="微信打赏">  
    </div>
	<script type="text/javascript">
		document.getElementById('btn_donate').onclick = function(){
			$('#donate_board').addClass('hidden');
			$('#donate_guide').removeClass('hidden');
		}
	</script>
</div>
<! -- 添加捐赠图标 -->



      <! -- 添加版权信息 -->
<div class="article-footer-copyright">
<left>本文由<b> <a href="/index.html" target="_blank" title="Iamasoldier6">Iamasoldier6</a> </b>创作和发表，采用<b>署名</b>-<b>非商用</b>-<b>禁止演绎 3.0 </b>国际许可协议进行许可。<br/></left>

<left>非商业转载请注明作者及出处，商业转载请联系作者本人。<br/>本文作者：<b><a href="/index.html" target="_blank" title="Iamasoldier6">Iamasoldier6</a></b><br/>本文标题：<b><a href="/2017/11/18/解读好用的-RecyclerView-第三方库-Groupie/" target="_blank" title="解读好用的 RecyclerView 第三方库 Groupie">解读好用的 RecyclerView 第三方库 Groupie</a></b></left>

<left><br/>本文链接：<b><a href="/2017/11/18/解读好用的-RecyclerView-第三方库-Groupie/" target="_blank" title="解读好用的 RecyclerView 第三方库 Groupie">http://iamasoldier6.com/2017/11/18/解读好用的-RecyclerView-第三方库-Groupie/</a></b></left>
</div>
<! -- 添加版权信息 -->
    
</article>


<div class="share_jia">
	<!-- JiaThis Button BEGIN -->
	<div class="jiathis_style">
		<span class="jiathis_txt">分享到: &nbsp; </span>
		<a class="jiathis_button_facebook"></a> 
    <a class="jiathis_button_twitter"></a>
    <a class="jiathis_button_plus"></a> 
    <a class="jiathis_button_tsina"></a>
		<a class="jiathis_button_cqq"></a>
		<a class="jiathis_button_douban"></a>
		<a class="jiathis_button_weixin"></a>
		<a class="jiathis_button_tumblr"></a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	</div>
	<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1405949716054953" charset="utf-8"></script>
	<!-- JiaThis Button END -->
</div>









</div>
      
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>



<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-75799138-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->




<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



<div id="totop" style="position:fixed;bottom:150px;right:50px;cursor: pointer;">
<a title="返回顶部"><img src="/img/scrollup.png"/></a>
</div>
<script src="/js/totop.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?4548ab92471a76e452c9750997a514f8";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

  </div>
</body>
</html>