<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>Android Volley 研究综述(二) | Iamasoldier6&#39;s Column</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Nothing is given, everything is earned, you work for what you have.

Universal-Image-Loader 具备强大的网络图片加载功能，使用 Volley，可以实现类似的效果，并且，在性能上也毫不逊色。">
<meta property="og:type" content="article">
<meta property="og:title" content="Android Volley 研究综述(二)">
<meta property="og:url" content="http://iamasoldier6.com/2016/05/15/Android-Volley-研究综述(二)/index.html">
<meta property="og:site_name" content="Iamasoldier6's Column">
<meta property="og:description" content="Nothing is given, everything is earned, you work for what you have.

Universal-Image-Loader 具备强大的网络图片加载功能，使用 Volley，可以实现类似的效果，并且，在性能上也毫不逊色。">
<meta property="og:image" content="http://7xt0ac.com1.z0.glb.clouddn.com/success2.png">
<meta property="og:image" content="http://7xt0ac.com1.z0.glb.clouddn.com/failure2.png">
<meta property="og:image" content="http://7xt0ac.com1.z0.glb.clouddn.com/imageloader3.png">
<meta property="og:updated_time" content="2016-12-03T10:47:37.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android Volley 研究综述(二)">
<meta name="twitter:description" content="Nothing is given, everything is earned, you work for what you have.

Universal-Image-Loader 具备强大的网络图片加载功能，使用 Volley，可以实现类似的效果，并且，在性能上也毫不逊色。">
<meta name="twitter:image" content="http://7xt0ac.com1.z0.glb.clouddn.com/success2.png">
  
    <link rel="alternative" href="/atom.xml" title="Iamasoldier6&#39;s Column" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon2.png">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="http://7xt0ac.com1.z0.glb.clouddn.com/cavs23.png" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Iamasoldier6</a></h1>
		</hgroup>

		
		<p class="header-subtitle">Forged from suffering, hardened by pain.</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">归档</a></li>
				        
							<li><a href="/about">关于我</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/Iamasoldier6" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="http://weibo.com/2253797763/profile?topnav=1&wvr=6&is_all=1" title="weibo">weibo</a>
					        
								<a class="zhihu" target="_blank" href="https://www.zhihu.com/people/Iamasoldier6" title="zhihu">zhihu</a>
					        
								<a class="twitter" target="_blank" href="https://twitter.com/Iamasoldier6" title="twitter">twitter</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/AOSP/" style="font-size: 10px;">AOSP</a> <a href="/tags/Android/" style="font-size: 20px;">Android</a> <a href="/tags/Annotation/" style="font-size: 10px;">Annotation</a> <a href="/tags/Annual/" style="font-size: 10px;">Annual</a> <a href="/tags/Event/" style="font-size: 12.5px;">Event</a> <a href="/tags/HTML/" style="font-size: 10px;">HTML</a> <a href="/tags/Handler/" style="font-size: 10px;">Handler</a> <a href="/tags/Java/" style="font-size: 12.5px;">Java</a> <a href="/tags/JavaScript/" style="font-size: 10px;">JavaScript</a> <a href="/tags/ListView/" style="font-size: 10px;">ListView</a> <a href="/tags/Mac/" style="font-size: 15px;">Mac</a> <a href="/tags/Message/" style="font-size: 10px;">Message</a> <a href="/tags/Pattern/" style="font-size: 12.5px;">Pattern</a> <a href="/tags/React-Native/" style="font-size: 10px;">React Native</a> <a href="/tags/RecyclerView/" style="font-size: 10px;">RecyclerView</a> <a href="/tags/Reflection/" style="font-size: 10px;">Reflection</a> <a href="/tags/Source-Code/" style="font-size: 17.5px;">Source Code</a> <a href="/tags/Summary/" style="font-size: 10px;">Summary</a> <a href="/tags/Volley/" style="font-size: 17.5px;">Volley</a>
					</div>
				</section>
				
				
				

				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">Iamasoldier6</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="http://7xt0ac.com1.z0.glb.clouddn.com/cavs23.png" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">Iamasoldier6</h1>
			</hgroup>
			
			<p class="header-subtitle">Forged from suffering, hardened by pain.</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">归档</a></li>
		        
					<li><a href="/about">关于我</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/Iamasoldier6" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/2253797763/profile?topnav=1&wvr=6&is_all=1" title="weibo">weibo</a>
			        
						<a class="zhihu" target="_blank" href="https://www.zhihu.com/people/Iamasoldier6" title="zhihu">zhihu</a>
			        
						<a class="twitter" target="_blank" href="https://twitter.com/Iamasoldier6" title="twitter">twitter</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap"><article id="post-Android-Volley-研究综述(二)" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/05/15/Android-Volley-研究综述(二)/" class="article-date">
  	<time datetime="2016-05-15T15:02:15.000Z" itemprop="datePublished">2016-05-15</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Android Volley 研究综述(二)
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Volley/">Volley</a></li></ul>
	</div>

        

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        
  <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
  <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#ImageRequest-的使用"><span class="toc-number">1.</span> <span class="toc-text">ImageRequest 的使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ImageLoader-的使用"><span class="toc-number">2.</span> <span class="toc-text">ImageLoader 的使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NetworkImageView-的使用"><span class="toc-number">3.</span> <span class="toc-text">NetworkImageView 的使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考文献"><span class="toc-number">4.</span> <span class="toc-text">参考文献</span></a></li></ol>
  </div>

        <blockquote>
<p>Nothing is given, everything is earned, you work for what you have.</p>
</blockquote>
<p>Universal-Image-Loader 具备强大的网络图片加载功能，使用 Volley，可以实现类似的效果，并且，在性能上也毫不逊色。<a id="more"></a>本篇在<a href="http://iamasoldier6.com/2016/04/30/Android-Volley-研究综述（一）/"> Android Volley 研究综述(一) </a>的基础上继续展开，分析关于 Volley 加载网络图片。</p>
<h2 id="ImageRequest-的使用"><a href="#ImageRequest-的使用" class="headerlink" title="ImageRequest 的使用"></a><strong>ImageRequest 的使用</strong></h2><p>ImageRequestDemo 地址: <a href="https://github.com/Iamasoldier6/AndroidExerciseDemos" target="_blank" rel="external"> ImageRequestDemo</a>。</p>
<p>ImageRequest，指定一个 URL，并在响应回调中接收一张图片。具体来说，ImageRequest 是一个封装好的 request，用来在给定的 URL 中获得一张图片，同时调回一张解码过的位图。它也提供了些便捷的特性，如指定一种大小来重新裁剪。其主要优点是，Volley 的线程调度确保昂贵的图片操作(解码，重新裁剪)自动地在工作线程中发生。</p>
<p>以上来自官网，总结来说，同 StringRequest 和 JsonRequest 类似，使用大体分以下三步：</p>
<p>I.创建一个 RequestQueue 对象。</p>
<p>II.创建一个 Request 对象。</p>
<p>III.将 Request 对象添加到 RequestQueue 里面。</p>
<p>同样，首先，在 MainActivity 的 onCreate() 方法里，需要获取到一个 RequestQueue 对象：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RequestQueue <span class="built_in">queue</span> = Volley.newRequestQueue(<span class="keyword">this</span>);</span><br></pre></td></tr></table></figure>
<p>接着，初始化：</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">final ImageView mImageView<span class="comment">;</span></span><br><span class="line">mImageView = (<span class="name">ImageView</span>) findViewById(<span class="name">R</span>.id.myImage)<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>同时，在 drawable 目录下放入一张 default_image 图片，删掉 activity_main.xml 中的 TextView，即删掉：</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;TextView</span><br><span class="line">    android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:<span class="built_in">text</span>=<span class="string">"Hello World!"</span>/&gt;</span><br></pre></td></tr></table></figure>
<p>添加 ImageView：</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;ImageView</span><br><span class="line">    android:<span class="built_in">id</span>=<span class="string">"@+id/myImage"</span></span><br><span class="line">    android:layout_width=<span class="string">"200dp"</span></span><br><span class="line">    android:layout_height=<span class="string">"200dp"</span></span><br><span class="line">    android:layout_marginLeft=<span class="string">"65dp"</span></span><br><span class="line">    android:layout_marginTop=<span class="string">"150dp"</span></span><br><span class="line">    android:layout_gravity=<span class="string">"center"</span>/&gt;</span><br></pre></td></tr></table></figure>
<p>然后，要 new 出一个 ImageRequest 对象：</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">String url = <span class="string">"http://7xt0ac.com1.z0.glb.clouddn.com/AR.jpg"</span>;</span><br><span class="line"></span><br><span class="line">ImageRequest imageRequest = <span class="keyword">new</span> ImageRequest(url,</span><br><span class="line">        <span class="keyword">new</span> Response.Listener&lt;Bitmap&gt;() &#123;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Bitmap response)</span> </span>&#123;</span><br><span class="line">                mImageView.setImageBitmap(response);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="number">0</span>, <span class="number">0</span>, Bitmap.Config.RGB_565, <span class="keyword">new</span> Response.ErrorListener() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onErrorResponse</span><span class="params">(VolleyError <span class="keyword">error</span>)</span> </span>&#123;</span><br><span class="line">        mImageView.setImageResource(R.drawable.default_image);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>ImageRequest() 方法接收六个参数，第一个是图片的 URL 地址；第二个是图片请求成功的回调，将返回的 Bitmap 参数设置到 ImageView 中；第三个和第四个分别用于指定图片的最大宽度和最大高度，若指定图片的宽度或高度大于最大值，则对图片进行压缩，指定为 0，则无论图片多大，都不会压缩；第五个用于指定图片的颜色属性；第六个是图片请求失败的回调，失败时在 ImageView 中显示一张默认的图片，即显示 default_image。</p>
<p>最后，将该 ImageRequest 对象添加到 RequestQueue 里面即可：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">queue</span>.add(imageRequest);</span><br></pre></td></tr></table></figure>
<p>同样，不要忘了在 AndroidManifest.xml 文件中添加一条权限：</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;uses-permission android:<span class="built_in">name</span>=<span class="string">"android.permission.INTERNET"</span>/&gt;</span><br></pre></td></tr></table></figure>
<p>运行程序，发送网络请求，正常成功的话，显示：</p>
<p><img src="http://7xt0ac.com1.z0.glb.clouddn.com/success2.png" alt=""></p>
<p>如果因各种意外原因，请求失败的话，显示：</p>
<p><img src="http://7xt0ac.com1.z0.glb.clouddn.com/failure2.png" alt=""></p>
<h2 id="ImageLoader-的使用"><a href="#ImageLoader-的使用" class="headerlink" title="ImageLoader 的使用"></a><strong>ImageLoader 的使用</strong></h2><p>ImageLoaderDemo 地址: <a href="https://github.com/Iamasoldier6/AndroidExerciseDemos" target="_blank" rel="external"> ImageLoaderDemo</a>。</p>
<p>ImageLoader，一个处理加载与缓存从远程 URLs 获取图片的帮助类。它是一个大量 ImageRequest 的协调器，如将许多小图片放入 ListView 中。ImageLoader 提供了一个超前于标准 Volley 缓存的内存内缓存，这对于防止抖动是重要的。在未堵塞或延迟主线程的情况下，这让实现缓存击中成为可能，不过，当使用磁盘 I/O 时是不可能的。ImageLoader 也能实现响应合并，没有它的话，几乎每一个响应处理机会将 bitmap 放到 view 上，并且会造成每一张图片的布局传递。合并让同时传送多个响应成为可能，这提升了性能。</p>
<p>以上来自官网，总结来说，ImageLoader 也可以用来加载网络上的图片，并且它的内部也是使用 ImageRequest 实现的。但是，ImageLoader 较 ImageRequest 更高效，它不仅可以对图片进行缓存，还可以过滤掉重复的链接，避免重复发送请求。<br>ImageLoader 不是继承自 Request，用法也与之前有所不同，大致分四步：</p>
<p>I.创建一个 RequestQueue 对象。</p>
<p>II.创建一个 ImageLoader 对象。</p>
<p>III.获取一个 ImageListener 对象。</p>
<p>IV.调用 ImageLoader 的 get() 方法加载网络上的图片。</p>
<p>具体如下：</p>
<p>第一步与初始化部分同上述 ImageRequest 的一样。</p>
<p>接着，new 一个 ImageLoader 对象：</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">String url = <span class="string">"http://7xt0ac.com1.z0.glb.clouddn.com/AR.jpg"</span>;</span><br><span class="line"></span><br><span class="line">ImageLoader imageLoader = <span class="keyword">new</span> ImageLoader(queue, <span class="keyword">new</span> ImageLoader.ImageCache() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">putBitmap</span><span class="params">(String url, Bitmap bitmap)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function">Bitmap <span class="title">getBitmap</span><span class="params">(String url)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>ImageLoader() 方法接收两个参数，第一个是 RequestQueue 对象，第二个是 ImageCache 对象，暂且先 new 出一个空的 ImageCache 实现。</p>
<p>然后，获取一个 ImageListener 对象，在此之前的基础上，再放一张 failed_image 图片至 drawable 目录下：</p>
<figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ImageLoader.ImageListener listener = ImageLoader.getImageListener(mImageView,</span><br><span class="line">        <span class="keyword">R</span>.drawable.default_image, <span class="keyword">R</span>.drawable.failed_image)<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>调用 ImageLoader 的 getImageListener() 方法获取到一个 ImageListener 对象，getImageListener() 方法接收三个参数，第一个指定显示图片的 ImageView 控件，第二个指定加载图片过程中默认显示的图片，第三个指定加载图片失败时显示的图片。</p>
<p>最后，调用 ImageLoader 的 get() 方法加载图片：</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">imageLoader.<span class="keyword">get</span>(url, listener);</span><br></pre></td></tr></table></figure>
<p>get() 方法接收两个参数，第一个是图片的 URL， 第二个是获取到的 ImageListener 对象。另外，要对图片的大小进行限制，使用 get() 方法的重载，指定图片允许的最大宽度和最大高度，如下：</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">imageLoader.<span class="keyword">get</span>(url, listener, <span class="number">200</span>, <span class="number">200</span>);</span><br></pre></td></tr></table></figure>
<p>同样，不要忘了在 AndroidManifest.xml 文件中添加同上面一样的权限。</p>
<p>运行程序，先会显示默认的图片，最后效果图如下：</p>
<p><img src="http://7xt0ac.com1.z0.glb.clouddn.com/imageloader3.png" alt=""></p>
<p>ImageLoaderCacheDemo 地址: <a href="https://github.com/Iamasoldier6/AndroidExerciseDemos" target="_blank" rel="external"> ImageLoaderCacheDemo</a>。</p>
<p>学会了 ImageLoader 的使用，但是其优点却没有用到。上述代码中，创建的 ImageCache 对象是一个空实现，没能起到图片缓存的作用。这里，借助 Android 提供的 LruCache 功能，写一个性能很好的 ImageCache，新建一个 BitmapCache 并实现 ImageCache 接口：</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BitmapCache</span> <span class="keyword">implements</span> <span class="title">ImageLoader</span>.<span class="title">ImageCache</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> LruCache&lt;String, Bitmap&gt; mCache;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BitmapCache</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> maxSize = <span class="number">1</span> * <span class="number">1024</span> * <span class="number">1024</span>;</span><br><span class="line">        mCache = <span class="keyword">new</span> LruCache&lt;String, Bitmap&gt;(maxSize) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">protected</span> <span class="function"><span class="keyword">int</span> <span class="title">sizeOf</span><span class="params">(String key, Bitmap bitmap)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> bitmap.getRowBytes() * bitmap.getHeight();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function">Bitmap <span class="title">getBitmap</span><span class="params">(String url)</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">return</span> mCache.<span class="title">get</span><span class="params">(url)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">putBitmap</span><span class="params">(String url, Bitmap bitmap)</span> </span>&#123;</span><br><span class="line">        mCache.put(url, bitmap);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>将缓存图片的大小设置为 1M，修改创建 ImageLoader 实例的代码，第二个参数传入 BitmapCache 的实例：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ImageLoader imageLoader = <span class="keyword">new</span> ImageLoader(<span class="built_in">queue</span>, <span class="keyword">new</span> BitmapCache());</span><br></pre></td></tr></table></figure>
<p>然后其他所有，与前面的设置及代码一样，运行，Logcat 报出 unknown buffer。在 Stack Overflow 上找到解决办法，即于 AndroidManifest.xml 文件中添加最后一行代码，具体如图：</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;application</span><br><span class="line">    android:allowBackup=<span class="string">"true"</span></span><br><span class="line">    android:icon=<span class="string">"@mipmap/ic_launcher"</span></span><br><span class="line">    android:label=<span class="string">"@string/app_name"</span></span><br><span class="line">    android:supportsRtl=<span class="string">"true"</span></span><br><span class="line">    android:theme=<span class="string">"@style/AppTheme"</span></span><br><span class="line">    android:largeHeap=<span class="string">"true"</span>&gt;</span><br></pre></td></tr></table></figure>
<p>使用 largeHeap，请求系统为 Dalvik 虚拟机分配更大的内存空间，解决内存过小不够用导致的 OutOfMemoryError 的问题。最后，再运行，显示与上面的图片显示一样。</p>
<h2 id="NetworkImageView-的使用"><a href="#NetworkImageView-的使用" class="headerlink" title="NetworkImageView 的使用"></a><strong>NetworkImageView 的使用</strong></h2><p>NetworkImageViewDemo 地址: <a href="https://github.com/Iamasoldier6/AndroidExerciseDemos" target="_blank" rel="external"> NetworkImageViewDemo</a>。</p>
<p>NetworkImageView，建立在 ImageLoader 上，并且在你的图片通过网络 URL 取回的情况下，有效地替代 ImageView。如果 view 从层级结构中分离，NetworkImageView 也能管理取消待处理的请求。</p>
<p>以上来自官网，总结来说，NetworkImageView 是一个自定义控制，继承自 ImageView，具备 ImageView 的所有功能，并在原始的基础上拥有加载网络图片的功能。大致分以下五步：</p>
<p>I.创建一个 RequestQueue 对象。</p>
<p>II.创建一个 ImageLoader 对象。</p>
<p>III.布局文件中添加一个 NetworkImageView 的控件。</p>
<p>IV.代码中获取该控件的实例。</p>
<p>V.设置要加载的图片地址。</p>
<p>第一步与初始化部分仍然同 ImageRequest 的大致一样。不过，添加 ImageView 部分改为添加 NetworkImageView 部分如下：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;com<span class="selector-class">.android</span><span class="selector-class">.volley</span><span class="selector-class">.toolbox</span><span class="selector-class">.NetworkImageView</span></span><br><span class="line">    android:id=<span class="string">"@+id/networkImageView"</span></span><br><span class="line">    android:layout_width=<span class="string">"200dp"</span></span><br><span class="line">    android:layout_height=<span class="string">"200dp"</span></span><br><span class="line">    android:layout_marginLeft=<span class="string">"65dp"</span></span><br><span class="line">    android:layout_marginTop=<span class="string">"150dp"</span></span><br><span class="line">    android:layout_gravity=<span class="string">"center"</span>/&gt;</span><br></pre></td></tr></table></figure>
<p>然后，得到了 NetworkImageView 控件的实例后，调用 setDefaultImageResId() 方法、setErrorImageResId() 方法和 setImageUrl() 方法来分别设置加载成功显示的图片，加载失败时显示的图片和目标图片的 URL 地址。如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">mNetworkImageView</span><span class="selector-class">.setDefaultImageResId</span>(<span class="selector-tag">R</span><span class="selector-class">.drawable</span><span class="selector-class">.default_image</span>);</span><br><span class="line"><span class="selector-tag">mNetworkImageView</span><span class="selector-class">.setErrorImageResId</span>(<span class="selector-tag">R</span><span class="selector-class">.drawable</span><span class="selector-class">.failed_image</span>);</span><br><span class="line"><span class="selector-tag">mNetworkImageView</span><span class="selector-class">.setImageUrl</span>(<span class="selector-tag">url</span>, <span class="selector-tag">imageLoader</span>);</span><br></pre></td></tr></table></figure>
<p>setImageUrl() 方法接收两个参数，第一个指定图片的 URL 地址，第二个是前面创建好的 ImageLoader 对象，姑且使用未设置图片缓存的代码。然后一些基本事项无需赘述，运行程序，看到效果与 ImageLoader 的效果是一样的。</p>
<p>值得注意的是，使用 ImageRequest 和 ImageLoader 两种方式加载图片都可以传入一个最大宽度和最大高度的参数来对图片进行压缩。然而，对于 NetworkImageView，并不需要提供任何设置最大宽高的方法也能对加载的图片进行压缩。它是一个控件，在加载图片的时候会自动获取自身的宽高，然后对比网络图片的宽高，再决定是否需要对图片进行压缩。整个压缩过程在内部是完全自动化的，其呈现给我们的始终是一张大小刚好的图片，不会多占用任何一点内存。</p>
<p>当然，不愿压缩图片的话，只需要在布局文件中将 layout_width 和 layout_height 都设置成 wrap_content 即可。至此，关于 Android Volley 研究综述(二)到此结束，(三)未完待续。 </p>
<p><strong><em>本人才疏学浅，如有疏漏错误之处，望读者中有识之士不吝赐教，谢谢。</em></strong><br><br></p>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a><strong>参考文献</strong></h2><p>1.<a href="http://developer.android.com/training/volley/request.html" target="_blank" rel="external">http://developer.android.com/training/volley/request.html</a></p>
<p>2.<a href="http://developer.android.com/training/volley/requestqueue.html" target="_blank" rel="external">http://developer.android.com/training/volley/requestqueue.html</a></p>
<p>3.<a href="http://blog.csdn.net/guolin_blog/article/details/17482165" target="_blank" rel="external">http://blog.csdn.net/guolin_blog/article/details/17482165</a></p>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/05/28/Android-Volley-研究综述(三)/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          Android Volley 研究综述(三)
        
      </div>
    </a>
  
  
    <a href="/2016/04/30/Android-Volley-研究综述(一)/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">Android Volley 研究综述(一)</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  

  
  <! -- 添加捐赠图标 -->
<div class ="post-donate">
    <div id="donate_board" class="donate_bar center">
        <a id="btn_donate" class="btn_donate" href="javascript:;" title="打赏"></a>
        <span class="donate_txt">
           &uarr;<br>
		   博主沥血作文章，客官随性打钱赏。左边支付宝打赏，右边微信打赏。
        </span>
        <br>
      </div>  
	<div id="donate_guide" class="donate_bar center hidden" >
		<!-- 支付宝打赏图案 -->
		<img src="http://7xt0ac.com1.z0.glb.clouddn.com/ZFB.png" alt="支付宝打赏"> 
		<!-- 微信打赏图案 -->
		<img src="http://7xt0ac.com1.z0.glb.clouddn.com/WX6.png" alt="微信打赏">  
    </div>
	<script type="text/javascript">
		document.getElementById('btn_donate').onclick = function(){
			$('#donate_board').addClass('hidden');
			$('#donate_guide').removeClass('hidden');
		}
	</script>
</div>
<! -- 添加捐赠图标 -->



      <! -- 添加版权信息 -->
<div class="article-footer-copyright">
<left>本文由<b> <a href="/index.html" target="_blank" title="Iamasoldier6">Iamasoldier6</a> </b>创作和发表，采用<b>署名</b>-<b>非商用</b>-<b>禁止演绎 3.0 </b>国际许可协议进行许可。<br/></left>

<left>非商业转载请注明作者及出处，商业转载请联系作者本人。<br/>本文作者：<b><a href="/index.html" target="_blank" title="Iamasoldier6">Iamasoldier6</a></b><br/>本文标题：<b><a href="/2016/05/15/Android-Volley-研究综述(二)/" target="_blank" title="Android Volley 研究综述(二)">Android Volley 研究综述(二)</a></b></left>

<left><br/>本文链接：<b><a href="/2016/05/15/Android-Volley-研究综述(二)/" target="_blank" title="Android Volley 研究综述(二)">http://iamasoldier6.com/2016/05/15/Android-Volley-研究综述(二)/</a></b></left>
</div>
<! -- 添加版权信息 -->
    
</article>


<div class="share_jia">
	<!-- JiaThis Button BEGIN -->
	<div class="jiathis_style">
		<span class="jiathis_txt">分享到: &nbsp; </span>
		<a class="jiathis_button_facebook"></a> 
    <a class="jiathis_button_twitter"></a>
    <a class="jiathis_button_plus"></a> 
    <a class="jiathis_button_tsina"></a>
		<a class="jiathis_button_cqq"></a>
		<a class="jiathis_button_douban"></a>
		<a class="jiathis_button_weixin"></a>
		<a class="jiathis_button_tumblr"></a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	</div>
	<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1405949716054953" charset="utf-8"></script>
	<!-- JiaThis Button END -->
</div>






<div class="duoshuo">
	<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="Android-Volley-研究综述(二)" data-title="Android Volley 研究综述(二)" data-url="http://iamasoldier6.com/2016/05/15/Android-Volley-研究综述(二)/"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"iamasoldier6"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
	<!-- 多说公共JS代码 end -->
</div>






</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 Iamasoldier6
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Iamasoldier6

          <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
          </script>
          本站总访问量<span id="busuanzi_value_site_pv"></span>次，本站访客数<span id="busuanzi_value_site_uv"></span>人次，本文总阅读量<span id="busuanzi_value_page_pv"></span>次

      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>



<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-75799138-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->




<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



<div id="totop" style="position:fixed;bottom:150px;right:50px;cursor: pointer;">
<a title="返回顶部"><img src="/img/scrollup.png"/></a>
</div>
<script src="/js/totop.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?4548ab92471a76e452c9750997a514f8";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

  </div>
</body>
</html>